<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>js-pdf-utils</title>
    <style>
      body {
        font-family: system-ui, sans-serif;
        max-width: 720px;
        margin: 2rem auto;
        line-height: 1.6;
      }

      button {
        padding: 0.75rem 1.5rem;
        font-size: 1rem;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <h1>doc.html() Renderer Test</h1>
    <p>
      Click the button below to render the HTML element below directly to PDF
      using <code>doc.html()</code> with Arabic text reshaping.
    </p>
    <button id="generate-html">Generate PDF (doc.html)</button>
    <button id="generate-html-2">Generate PDF image</button>
    <button id="preview-images">Preview as images</button>
    <div id="preview-container"></div>
    <div
      id="print-section"
      dir="rtl"
      lang="ar"
      style="text-align: right; direction: rtl; font-family: Arial, sans-serif"
    >
      <h2 style="margin: 0">نموذج مستند عربي</h2>
      <p style="margin: 0">
        العام الدراسي <strong>2019-2020</strong> كان مميزاً
      </p>
      <p style="margin: 0">من 2019-2020 إلى 2023-2024 شهدنا تطوراً كبيراً</p>
      <p style="margin: 0">اتصل على الرقم +964-770-123-4567 أو 0771-234-5678</p>
      <p style="margin: 0">
        جامعة كلكامش وانطلقت في مسيرتها التعليمية مطلع العام الدراسي 2019-2020
        تضم الجامعة عدداً من الكليات جامعة كلكامش وانطلقت في مسيرتها التعليمية
        مطلع العام الدراسي 2019-2020 تضم الجامعة عدداً من الكليات جامعة كلكامش
        وانطلقت في مسيرتها التعليمية مطلع العام الدراسي 2019-2020 تضم الجامعة
        عدداً من الكليات جامعة كلكامش وانطلقت في مسيرتها التعليمية مطلع العام
        الدراسي 2019-2020 تضم الجامعة عدداً من الكليات جامعة كلكامش وانطلقت في
        مسيرتها التعليمية مطلع العام الدراسي 2019-2020 تضم الجامعة عدداً من
        الكليات جامعة كلكامش وانطلقت في مسيرتها التعليمية مطلع العام الدراسي
        2019-2020 تضم الجامعة عدداً من الكليات جامعة كلكامش وانطلقت في مسيرتها
        التعليمية مطلع العام الدراسي 2019-2020 تضم الجامعة عدداً من الكليات
      </p>
      <table
        border="1"
        cellpadding="4"
        style="border-collapse: collapse; width: 100%; text-align: right"
      >
        <tr>
          <td>فاطمة علي</td>
          <td>20/06/2015</td>
          <td>88</td>
        </tr>
        <tr>
          <td>أحمد محمد</td>
          <td>15/05/1990</td>
          <td>95</td>
        </tr>
        <tr>
          <td>فاطمة علي</td>
          <td>20/06/2015</td>
          <td>88</td>
        </tr>
      </table>
      <div style="font-weight: bold; position: relative; overflow: visible">
        <div style="position: relative; min-height: 60px">
          <div>التوقيع:</div>
          <img
            src="/images/AhmedMohammedMhoder.png"
            style="
              width: 224px;
              height: auto;
              max-height: 130px;
              object-fit: contain;
              position: absolute;
              top: -30px;
            "
            alt="signature"
          />
        </div>
        <div>اسم المستلم: احمد محمد مهودر</div>

        <img
          src="/images/Mark.png"
          style="
            width: 224px;
            height: auto;
            position: absolute;
            right: 50%;
            top: -30px;
            transform: translateX(50%);
          "
          alt="signature"
        />
      </div>
    </div>

    <script type="module">
      import {
        generateImagePDF,
        generatePDF,
        previewImages,
      } from "./src/html-to-pdf.js";
      import { jsPDF } from "jspdf";
      const RECEIPT_DATA = {
        number: 111008194,
        createdAt: "2026-01-20T12:37:14.692405Z",
        year: 2025,
        month: 12,
        fromYear: 2025,
        fromMonth: 1,
        companyName: "مكتب بلسم الحياة العلمي لدعاية الادوية",
        registrationNumber: "1111097450",
        total: 2763172,
        rnn: "000658139832",
        resolvedAt: "2026-01-20T15:14:23.206Z",
        subval: 2509200,
        subvalType: "POS ONLINE",
        subval2: 0,
        subvalType2: "POS ONLINE",
        forval1: 125460,
        forval1Type: "POS ONLINE",
        forval12: 0,
        forval1Type2: "POS ONLINE",
        forval2: 0,
        forval2Type: "POS ONLINE",
        forval22: 0,
        forval2Type2: "POS ONLINE",
        servicefees: 92213,
        servicefeesType: "POS ONLINE",
        servicefees2: 0,
        servicefeesType2: "POS ONLINE",
        inquiryfees: 0,
        inquiryfeesType: "POS ONLINE",
        inquiryfees2: 0,
        inquiryfeesType2: "POS ONLINE",
        yearlyfees: 25000,
        yearlyfeesType: "POS ONLINE",
        yearlyfees2: 0,
        yearlyfeesType2: "POS ONLINE",
        paymentfees: 10000,
        savings: 1299,
        savingsGate: "492 ايرادات عرضية",
        savingsType: "POS ONLINE",
        managerName: "احمد محمد مهودر",
        managerSigniture: "AhmedMohammedMhoder.png",
      };

      export function convertDateFormat(dateString) {
        if (!dateString) return null;

        const date = new Date(dateString);
        const options = {
          year: "numeric",
          month: "2-digit",
          day: "2-digit",
        };

        return date.toLocaleString("en-CA", options);
      }

      const pdfOptions = {
        format: "a5",
        margin: { top: 10, bottom: 10, left: 12, right: 12 },
        marginContent: {
          textBorder: {
            text: `اسم المشروع ${RECEIPT_DATA.companyName} - وصل قبض - تاريخ الوصل ${convertDateFormat(RECEIPT_DATA.createdAt)} - مبلغ الوصل الكلي ${RECEIPT_DATA.total.toLocaleString()} - رقم الوصل ${RECEIPT_DATA.number} - `,
            fontSize: 2,
            margin: 6,
            fontWeight: "bold",
          },
        },
      };

      const marginContent = {
        top: (page, total) => {
          const el = document.createElement("div");
          el.innerHTML = `
            <div style="display:flex; justify-content:space-between; align-items:center; padding:6mm 10mm 0; font-family:Arial,sans-serif; font-size:9px; color:#000;">
              <span>Gilgamesh University</span>
              <span>Academic Year 2019-2020</span>
            </div>
            <div style="border-bottom:1px solid #000; margin:2mm 10mm 0;"></div>
          `;
          return el;
        },
        bottom: (page, total) => {
          const el = document.createElement("div");
          el.innerHTML = `
            <div style="display:flex; flex-direction:column; align-items:center; padding:0 10mm; font-family:Arial,sans-serif; font-size:8px; color:#000; position:absolute; bottom:6mm; left:0; right:0;">
              <div style="border-top:1px solid #ccc; width:calc(100% - 20mm); margin-bottom:2mm;"></div>
              <span>Page ${page} of ${total}</span>
            </div>
          `;
          return el;
        },
        textBorder: pdfOptions,
      };

      const pdfOpts = pdfOptions;

      const doc = new jsPDF(pdfOpts);

      doc.addFont("./fonts/arial.ttf", "arial", "normal");
      doc.addFont("./fonts/arial-bold.ttf", "arial", "bold");

      const htmlButton = document.getElementById("generate-html");
      const imageButton = document.getElementById("generate-html-2");
      const previewImagesButton = document.getElementById("preview-images");
      const previewContainer = document.getElementById("preview-container");

      htmlButton.addEventListener("click", async () => {
        const target = document.getElementById("print-section");
        if (!target) return;

        const imagePDF = await generatePDF(doc, target, pdfOpts);
        imagePDF.save("doc-html-renderer-test.pdf");
      });

      imageButton.addEventListener("click", async () => {
        const target = document.getElementById("print-section");
        if (!target) return;

        const imagePDF = await generateImagePDF(target, pdfOpts);
        imagePDF.save("doc-html-renderer-test.pdf");
      });

      // Preview as page images
      previewImagesButton.addEventListener("click", async () => {
        const target = document.getElementById("print-section");
        if (!target) return;

        await previewImages(target, previewContainer, pdfOpts);
      });
    </script>
  </body>
</html>
